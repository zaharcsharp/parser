<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–§–∏–ª—å—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏–π</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 500px;
      margin: 30px auto;
      background: #f4f4f4;
      padding: 20px;
      border-radius: 10px;
    }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      font-size: 16px;
    }
    button {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
    }
    h1 {
      text-align: center;
    }
    .link {
      display: block;
      margin-top: 15px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞</h1>
  <form action="/set" method="POST">
    <label for="min">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:</label>
    <input type="number" id="min" name="min" min="0" value="0">

    <label for="max">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:</label>
    <input type="number" id="max" name="max" min="0" value="999999">

    <label for="date">–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ:</label>
    <select id="date" name="date">
      <option value="—Å–µ–≥–æ–¥–Ω—è">–°–µ–≥–æ–¥–Ω—è</option>
      <option value="–≤—á–µ—Ä–∞">–í—á–µ—Ä–∞</option>
      <option value="">–í—Å–µ –¥–∞—Ç—ã</option>
    </select>

    <label for="chat">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç:</label>
    <select id="chat" name="chat">
      <option disabled selected>–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤...</option>
    </select>

    <button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </form>

  <a href="/chats" class="link">üîÅ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –≤—Ä—É—á–Ω—É—é</a>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const select = document.getElementById('chat');
      try {
        const res = await fetch('/available-chats');
        const chats = await res.json();

        // –û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏
        select.innerHTML = '';

        if (chats.length === 0) {
          select.innerHTML = '<option disabled>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —á–∞—Ç–æ–≤</option>';
          return;
        }

        chats.forEach(chat => {
          const opt = document.createElement('option');
          opt.value = chat.id;
          opt.textContent = chat.name;
          select.appendChild(opt);
        });
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤:', err);
        select.innerHTML = '<option disabled>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤</option>';
      }
    });
  </script>
</body>
</html>
